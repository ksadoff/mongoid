- name: existing field - matches float
  document:
    pi: !ruby/object:BSON::Float 3.14
  query:
    pi:
      $type: 1
  matches: true

- name: existing field - does not match float
  document:
    pi: 3
  query:
    pi:
      $type: 1
  matches: false

- name: existing field - matches string
  document:
    name: !ruby/object:BSON::String "bob"
  query:
    name:
      $type: 2
  matches: true

- name: existing field - does not match string
  document:
    pi: 3
  query:
    pi:
      $type: 2
  matches: false

- name: existing field - matches Object
  document:
    name: !ruby/object:BSON::Object "bob"
  query:
    name:
      $type: 2
  matches: true

- name: existing field - does not match Object
  document:
    pi: 3
  query:
    pi:
      $type: 2
  matches: false

- name: existing field - matches array
  document:
    prices: !ruby/object:BSON::Array [1, 2, 3]
  query:
    prices:
      $type: 4
  matches: true

- name: existing field - does not match array
  document:
    pi: 3
  query:
    pi:
      $type: 4
  matches: false

- name: existing field - matches binData
  document:
    price: !ruby/object:BSON::Binary
      data: !binary |-
        IW==
      type: :generic
  query:
    price:
      $type: 5
  matches: true

- name: existing field - does not match binData
  document:
    price: 5
  query:
    price:
      $type: 5
  matches: false

- name: existing field - matches undefined
  document:
    price: !ruby/object:BSON::Undefined
      # dummy field so Undefined gets constructed
      test: 42
  query:
    price:
      $type: 6
  matches: true

- name: existing field - does not match undefined
  document:
    pi: 3
  query:
    pi:
      $type: 6
  matches: false

- name: existing field - matches ObjectId
  document:
    new_id: !ruby/object:BSON::ObjectId
      raw_data: !binary |-
        Xt0Zj+G4MlyV5hyJ
  query:
    new_id:
      $type: 7
  matches: true

- name: existing field - does not match ObjectId
  document:
    pi: 3
  query:
    pi:
      $type: 7
  matches: false

- name: existing field - matches boolean
  document:
    status: !ruby/object:BSON::Boolean true
  query:
    status:
      $type: 8
  matches: true

- name: existing field - does not match boolean
  document:
    pi: 3
  query:
    pi:
      $type: 8
  matches: false

- name: existing field - matches date with date_field
  document:
    date_field: 2020-11-19
  query:
    date_field:
      $type: 9
  matches: true

- name: existing field - matches date with time_field
  document:
    time_field: 2020-11-19 00:00:00
  query:
    time_field:
      $type: 9
  matches: true

- name: existing field - matches date with datetime_field
  document:
    datetime_field: 2020-11-19 00:00:00
  query:
    datetime_field:
      $type: 9
  matches: true

- name: existing field - matches date with default field
  document:
    day: 2020-11-19
  query:
    day:
      $type: 9
  matches: true

- name: existing field - does not match date
  document:
    name: 3
  query:
    name:
      $type: 9
  matches: false

- name: existing field - matches null
  document:
    name: !ruby/object:BSON::NilClass
  query:
    name:
      $type: 10
  matches: true

- name: existing field - does not match null
  document:
    pi: 3
  query:
    pi:
      $type: 10
  matches: false

- name: type is 0
  document:
    pi: 3.14
  query:
    pi:
      $type: 0
  error: true

- name: existing field - matches regex
  document:
    name: !ruby/object:BSON::Regexp::Raw
      pattern: /test/
      options: ''
  query:
    name:
      $type: 11
  matches: true

- name: existing field - does not match regex
  document:
    pi: 3
  query:
    pi:
      $type: 11
  matches: false

- name: existing field - matches DBPointer
  document:
    ptr: !ruby/object:BSON::DbPointer
      ref: "collection"
      id: !ruby/object:BSON::ObjectId
        raw_data: !binary |-
          Xt0Zj+G4MlyV5hyJ
  query:
    ptr:
      $type: 12
  matches: true

- name: existing field - does not match DBPointer
  document:
    ptr: 3
  query:
    ptr:
      $type: 12
  matches: false

- name: existing field - matches Code
  document:
    code: !ruby/object:BSON::Code
      javascript: "var foo = 42;"
  query:
    code:
      $type: 13
  matches: true

- name: existing field - does not match Code
  document:
    code: 42
  query:
    code:
      $type: 13
  matches: false

- name: existing field - matches symbol
  document:
   name: !ruby/object:BSON::Symbol :hello
  query:
    name:
      $type: 14
  matches: true

- name: existing field - does not match symbol
  document:
    pi: 3
  query:
    pi:
      $type: 14
  matches: false

- name: existing field - matches Code with Scope
  document:
    code: !ruby/object:BSON::CodeWithScope
      javascript: "this.value = name"
      scope: {name: "sid"}
  query:
    code:
      $type: 15
  matches: true

- name: existing field - does not match Code with Scope
  document:
    code: 42
  query:
    code:
      $type: 15
  matches: false

- name: existing field - matches Int32
  document:
    pi: !ruby/object:BSON::Int32
      value: 3
  query:
    pi:
      $type: 16
  matches: true

- name: existing field - does not match int
  document:
    pi: 3.14
  query:
    pi:
      $type: 16
  matches: false

- name: existing field - matches timestamp
  document:
    time: !ruby/object:BSON::Timestamp
      seconds: 4
      increment: 2
  query:
    time:
      $type: 17
  matches: true

- name: existing field - does not match timestamp
  document:
    name: 3
  query:
    name:
      $type: 17
  matches: false

- name: existing field - matches long
  document:
    number: !ruby/object:BSON::Int64
      value: 392141
  query:
    number:
      $type: 18
  matches: true

- name: existing field - does not match long
  document:
    name: "foo"
  query:
    name:
      $type: 18
  matches: false

- name: existing field - matches decimal
  document:
    number: !ruby/object:BSON::Decimal128
      low: 4224
      high: 3475653012423180288
  query:
    number:
      $type: 19
  matches: true

- name: existing field - does not match decimal
  document:
    name: "foo"
  query:
    name:
      $type: 19
  matches: false

- name: existing field - matches MinKey
  document:
    pi: !ruby/object:BSON::MinKey
      # dummy field so MinKey gets constructed
      test: 42
  query:
    pi:
      $type: -1
  matches: true

- name: existing field - does not match MinKey
  document:
    pi: 3
  query:
    pi:
      $type: -1
  matches: false

- name: existing field - matches MinKey
  document:
    pi: !ruby/object:BSON::MaxKey
      # dummy field so MaxKey gets constructed
      test: 42
  query:
    pi:
      $type: 127
  matches: true

- name: existing field - does not match MaxKey
  document:
    pi: 3
  query:
    pi:
      $type: 127
  matches: false

- name: type is too negative
  document:
    pi: 3.14
  query:
    pi:
      $type: -2
  error: true

- name: type is too large
  document:
    pi: 3.14
  query:
    pi:
      $type: 42
  error: true

- name: array argument for type
  document:
    pi: 3.14
  query:
    pi:
      $type: [1]
  matches: true

- name: hash argument
  document:
    pi: 3
  query:
    pi:
      $type: {}
  error: true
